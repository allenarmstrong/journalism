
		/*
 * Copyright (C) 2007 Trivantis Corporation
 */

	
var dragOffX=0;var dragOffY=0;function DropZone(x,y,w,h,A,f) {var B=this;B.x=x;B.y=y;B.w=w;B.h=h;B.dropId=A;B.dragItem=null;B.updFunc=f;};DropZone.prototype.checkWithinRect=function(A,B) {var C=this;var D=A.rtRect.width;var E=A.rtRect.height;var F=A.rtRect.x;var G=A.rtRect.y;var H={x:0,y:0};H.x=C.x+C.w/2;H.y=C.y+C.h/2;if(C.updFunc==A.updateDragFunc){if((F+divide(D,2)>=C.x&&F+divide(D,2)<=C.x+C.w)&&(G+divide(E,2)>=C.y&&G+divide(E,2)<=C.y+C.h)) return true;};return false;};function DragMgr() {var A=this;A.item=null;A.arrDragItems=[];A.arrDropZones=[];A.active=false;A.offX=0;A.offY=0;};DragMgr.prototype.onDragDrop=function() {if(this.item.updateDragFunc) this.item.updateDragFunc();};DragMgr.prototype.offsetDrag=function(A,B) {dragOffX=A;dragOffY=B;};DragMgr.prototype.addDrag=function(A,B,C) {this.arrDragItems[this.arrDragItems.length]=A;A.dragId=B;A.dropObj=null;A.updateDragFunc=C;A.isChoice=true;A.origX=A.rtRect.x;A.origY=A.rtRect.y;A.lyr={ dragId:B };A.checkWithinItem=function(x,y){var D=this.rtRect;var E=false;x-=dragOffX;y-=dragOffY;if(x>=D.x&&y>=D.y&&x<=D.x+D.width&&y<=D.y+D.height) E=true;return E;};A.restoreInit=function(){this.moveTo(this.origX,this.origY);if(this.dropObj){this.dropObj.dragItem=null;this.dropObj=null;}};};DragMgr.prototype.addDrop=function(x,y,w,h,A,f) {this.arrDropZones[this.arrDropZones.length]=new DropZone(x,y,w,h,A,f);};DragMgr.prototype.mouseDown=function(x,y,e) {var A=this;for (var i=A.arrDragItems.length-1;i>=0;i--){var B=A.arrDragItems[i];if (B.div.disabled) return false;if (B.checkWithinItem(x,y)){A.item=B;A.offX=x-A.item.rtRect.x;A.offY=y-A.item.rtRect.y;if(A.item.dropObj){A.item.dropObj.dragItem=null;A.item.dropObj=null;A.onDragDrop();};A.active=true;break;}};if (!A.active) return false;else return true;};DragMgr.prototype.mouseMove=function(x,y) {if (!this.active) return false;else{this.item.moveTo(x-this.offX,y-this.offY);return true;}};DragMgr.prototype.mouseUp=function(x,y) {var A=this;if (!A.active) return false;else{A.active=false;if (A.checkDrops()) A.onDragDrop();else A.item.restoreInit();return true;}};DragMgr.prototype.checkDrops=function() {var A=this.item;for(var B=0;B<2;B++){for (var i=this.arrDropZones.length-1;i>=0;i--){var C=this.arrDropZones[i];if (C.checkWithinRect(A,B)){C.dragItem=A;A.dropObj=C;if(this.bSnapToCenter) A.moveTo(C.x+divide(C.w,2)-divide(A.rtRect.width,2),C.y+divide(C.h,2)-divide(A.rtRect.height,2));return true;}}};return false;};DragMgr.prototype.setDropById=function(A,B,C) {for (var i=this.arrDragItems.length-1;i>=0;i--){var D=this.arrDragItems[i];if(D.dragId==A&&D.updateDragFunc==C){for (var j=this.arrDropZones.length-1;j>=0;j--){var E=this.arrDropZones[j];if (E.dropId==B&&E.updFunc==C){E.dragItem=D;D.dropObj=E;D.moveTo(E.x+divide(E.w,2)-divide(D.rtRect.width,2),E.y+divide(E.h,2)-divide(D.rtRect.height,2));return true;}}}};return false;};DragMgr.prototype.reset=function(A){if (A.disable) A.disable(0);trivArExec(A.arChld,function(B){if (B.restoreInit) B.restoreInit();});};function initDragMouseEvents() {var A=document;A.onmousedown=dragMouseDown;A.onmousemove=dragMouseMove;A.onmouseup=dragMouseUp;if (A.captureEvents) A.captureEvents(Event.MOUSEDOWN|Event.MOUSEMOVE|Event.MOUSEUP);if(A.body.addEventListener){var B=dragMgr.arrDragItems.length;for (var i=0;i<B;i++){var C=dragMgr.arrDragItems[i].div;C.addEventListener("touchstart",function(D){D=D||window.event;dragMouseDown(D);});C.addEventListener("touchmove",function(E){E=E||window.event;E.preventDefault();dragMouseMove(E);});C.addEventListener("touchend",function(F){dragMouseUp(F);});}}};function dragMouseDown(e) {if (!e) e=window.event;if ((e.which&&e.which!=1)||(is.ie10orless&&event.button!=1)) return true;var A=getAdjXY(e);if (dragMgr&&dragMgr.mouseDown(A.x,A.y,e)) return false;else return DynMouseDown(A.x,A.y);};function dragMouseMove(e) {if (!e) e=window.event;var A=getAdjXY(e);if (dragMgr&&dragMgr.mouseMove(A.x,A.y)) return false;else return DynMouseMove(A.x,A.y);};function dragMouseUp(e) {if (!e) e=window.event;var A=getAdjXY(e);if (dragMgr&&dragMgr.mouseUp(A.x,A.y)) return false;else return DynMouseUp(A.x,A.y);};function getAdjXY(e){var A=document,B=e.pageX?e.pageX:(event.x+A.body.scrollLeft),C=e.pageX?e.pageY:(event.y+A.body.scrollTop),D=A.getElementById('wndPage');B-=D.offsetLeft;C-=D.offsetTop;return {x:B,y:C};};function DynMouseDown(x,y) {return true;};function DynMouseMove(x,y) {return true;};function DynMouseUp(x,y) {return true;};dragMgr=new DragMgr();
